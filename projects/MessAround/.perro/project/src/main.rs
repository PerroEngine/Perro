// Auto-generated by Perro Engine compiler

// Embed assets.brk built by compiler/packer in release/export
static ASSETS_BRK: &[u8] = include_bytes!("../../../assets.brk");

// Embed icon in binary (Linux only)
#[cfg(target_os = "linux")]
mod embedded_icon {
    // Include the generated embedded icon module
    // OUT_DIR is set by Cargo and points to the build output directory
    include!(concat!(env!("OUT_DIR"), "/embedded_icon.rs"));
}

use perro_core::runtime::{run_game, RuntimeData, StaticAssets};

mod static_assets;

fn main() {
    // Parse command-line arguments into runtime parameters
    // Format: --key value (all --arg val pairs become runtime parameters)
    let args: Vec<String> = std::env::args().collect();
    let mut runtime_params = std::collections::HashMap::new();
    let mut key: Option<String> = None;
    for arg in args.iter().skip(1) {
        if arg.starts_with("--") {
            let clean_key = arg.trim_start_matches("--").to_string();
            key = Some(clean_key);
        } else if let Some(k) = key.take() {
            runtime_params.insert(k, arg.clone());
        }
    }

    // The root script can check these parameters via api.project().get_runtime_param()
    // and decide what to do based on them
    run_game(RuntimeData {
        assets_brk: ASSETS_BRK,
        aes_key: static_assets::key::get_aes_key(),
        static_assets: StaticAssets {
            project: &static_assets::manifest::PERRO_PROJECT,
            scenes: &static_assets::scenes::PERRO_SCENES,
            fur: &static_assets::fur::PERRO_FUR,
            textures: &static_assets::textures::PERRO_TEXTURES,
        },
        script_registry: scripts::get_script_registry(),
    }, runtime_params);
}
